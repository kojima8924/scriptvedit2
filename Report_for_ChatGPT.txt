============================================================
  scriptvedit2 プロジェクト状況レポート (Claude Code → ChatGPT)
  作成日: 2026-02-11
  最終更新: 2026-02-11
============================================================

============================================================
1. プロジェクト概要
============================================================

  Python DSL で動画を構成し ffmpeg でレンダリングするツール。
  「1ファイル = 1レイヤー」アーキテクチャを採用。
  main.py がオーケストレータ、各レイヤーは独立した .py ファイル。

  コアファイル: scriptvedit.py (約2310行)
  ライセンス: なし（個人プロジェクト）
  環境: Windows 11 / Python 3.10 / ffmpeg 8.0-full_build

  ◆ ファイル構成
    scriptvedit2/
    ├── scriptvedit.py   ← コアライブラリ (約2280行)
    ├── main.py          ← オーケストレータ (デモ用)
    ├── bg.py            ← 背景レイヤー (デモ用)
    ├── onigiri.py       ← おにぎりレイヤー (デモ用)
    ├── README.md        ← プロジェクト説明
    ├── Report_for_ChatGPT.txt ← 本レポート
    ├── templates/
    │   ├── subtitle.html      ← 字幕テンプレート
    │   ├── bubble.html        ← 吹き出しテンプレート
    │   └── diagram_svg.html   ← SVG図解テンプレート
    ├── test/
    │   ├── test_snapshot.py   ← スナップショットテスト (30テスト)
    │   ├── test_errors.py     ← エラーケーステスト (39テスト)
    │   ├── render_all.py      ← 全テスト動画の実レンダリング
    │   ├── snapshots/         ← スナップショットJSON (test01〜test30)
    │   ├── test01〜test30_main.py + レイヤーファイル群
    │   ├── test19_scene.html  ← web Objectテスト用HTML
    │   └── *.png, *.jpg       ← テスト用素材
    ├── *.png, *.jpg     ← 素材画像 (変更禁止)
    ├── *.mp4            ← 素材動画
    └── *.mp3            ← 素材音声

  ◆ コミット履歴 (古い順)
    9ea9b69 初期コミット: DSLベースの動画構成ツール
    161ee8f プリセット記法の追加とTransform関数からtarget引数を除去
    84750c6 DSLを <= 演算子に統一（破壊的変更）
    129c334 レイヤー記法を obj.time(6) <= effect_chain の1行形式に統一
    0c12e42 pos廃止→move Effect統合、media_type導入、cache機能追加
    72a91bf 画像キャッシュの透過対応と1ファイル1レイヤーテスト10件追加
    d44a0b3 anchor/pause/until機能と2パスアーキテクチャを追加
    3fc1416 Expr式ビルダー導入: Effect引数をfloat/lambda(u)/Expr統一（破壊的変更）
    6b09de3 layer()遅延化と2パスplan/render分離: アンカー解決の堅牢化
    955233f レビュー指摘全件改修: 重複排除・テスト強化・堅牢化
    f3c0192 レイヤーキャッシュ(webm alpha) + DSL糖衣(P/%・~無効化)の3機能追加
    db63456 音声合成(amix) + AV split + length() + AudioEffect基盤の大型拡張
    d2ae888 web Object機能追加: HTMLテンプレート→透明webm(VP9 alpha)→合成パイプライン
    8132e4b テンプレート機能(subtitle/bubble/diagram) + scaleアニメーション振動修正
    f38d42c チェックポイントキャッシュ記法を追加
    8a6630e キャッシュ再設計: policy/quality方式 + signatureベース ← 最新

============================================================
2. 主要クラスとAPI（全クラス・全ファクトリ関数の一覧と説明）
============================================================

  ◆ コアクラス
    Project          ... プロジェクト管理。configure/layer/renderを提供
    Object           ... 素材（画像/動画/音声/web）を表現。Transform/Effect/AudioEffectを適用
    Transform        ... 静的変換（resize等）。name + params辞書
    TransformChain   ... 複数のTransformを | で連結したチェーン
    Effect           ... 時間的エフェクト（move/scale/fade/trim/delete）。name + params辞書
    EffectChain      ... 複数のEffectを & で連結したチェーン
    AudioEffect      ... 音声エフェクト（again, afade, adelete, atrim, atempo等）。name + params辞書
    AudioEffectChain ... 複数のAudioEffectを & で連結したチェーン
    VideoView        ... split()で生成。映像系(Transform/Effect)のみ受け付けるビュー
    AudioView        ... split()で生成。音声系(AudioEffect)のみ受け付けるビュー

  ◆ 内部クラス
    _DisabledAudioEffect  ... AudioEffect/AudioEffectChainの無効化ラッパー（~で生成）
    ※ _CheckpointTransform/_CheckpointEffect は廃止。
      policy/qualityはTransform/Effectの属性として統合。

  ◆ アンカー/同期クラス
    _AnchorMarker    ... anchor()で生成。タイムライン上の位置を記録（非描画）
    Pause            ... pause.time(N)/pause.until(name)で生成。時間のみ占有（非描画）
    _PauseFactory    ... pauseシングルトンの型。time()/until()メソッドを持つ

  ◆ Expr（式ビルダー）クラス
    Expr             ... 基底クラス。四則演算・べき乗の演算子オーバーロード
    Const            ... 定数ノード (float/int)
    Var              ... 変数ノード ("u" = 正規化時間)
    _BinOp           ... 二項演算ノード (+, -, *, /)
    _UnOp            ... 単項演算ノード (-)
    _FuncCall        ... 関数呼び出しノード (sin, cos, lerp等)

  ◆ DSL糖衣クラス
    Percent          ... パーセント記法。P はシングルトンインスタンス

  ◆ ファクトリ関数（映像Transform）
    resize(sx=倍率, sy=倍率)   ... スケーリング Transform
    rotate(deg=角度)           ... 回転 Transform（deg or rad指定）

  ◆ ファクトリ関数（映像Effect）
    move(x, y, anchor, from_x, from_y, to_x, to_y) ... 位置/移動アニメーション
    scale(value)               ... 拡大縮小 (float=定数, lambda=アニメーション)
    fade(alpha)                ... 不透明度 (float=定数, lambda=アニメーション)
    trim(duration)             ... 映像トリム（時間影響あり）
    rotate_to(from_deg, to_deg) ... 回転アニメーション（bakeable）
    morph_to(target)           ... 画像モーフィング（bakeable、重い。bakeable ops末尾に配置必須）
    delete()                   ... 映像をオーバーレイから除外

  ◆ 方針: genchainは提供しない
    生成系（morph_to等）のチェーン化は行わない。生成系Effectは単体で使用。

  ◆ ファクトリ関数（音声AudioEffect）
    again(value)               ... 音量倍率 (float=定数, lambda=アニメーション)
    afade(alpha)               ... 音量フェード (float=定数, lambda=アニメーション)
    atrim(duration)            ... 音声トリム（時間影響あり）
    atempo(rate)               ... 音声テンポ変更（時間影響あり）
    adelete()                  ... 音声をミックスから除外

  ◆ アンカー/同期関数
    anchor(name)               ... 現在のレイヤー位置にアンカーを登録
    pause (シングルトン)
      pause.time(N)            ... N秒だけ時間を占有（Pauseを生成・登録）
      pause.until(name)        ... アンカーまで待機（Pauseを生成・登録）

  ◆ テンプレートラッパー関数
    subtitle(text, who, duration, style, size, name, debug_frames, deps)
    bubble(text, duration, anchor, pos, box, style, size, name, debug_frames, deps)
    diagram(objects, duration, style, size, name, debug_frames, deps)

  ◆ 図形ビルダー関数
    circle(x, y, r, **kw)     ... 円オブジェクト定義（diagram用）
    rect(x, y, w, h, **kw)    ... 矩形オブジェクト定義（diagram用）
    arrow(x1, y1, x2, y2, **kw) ... 矢印オブジェクト定義（diagram用）
    label(x, y, text, **kw)   ... テキストラベル定義（diagram用）
    spotlight(x, y, r, **kw)  ... スポットライト暗幕くり抜き定義（diagram用）

  ◆ Expr数学関数（from scriptvedit import * で使用可能）
    三角:       sin, cos, tan, asin, acos, atan, atan2
    双曲線:     sinh, cosh, tanh
    指数/対数:  exp, log, sqrt, log10, cbrt
    丸め:       floor, ceil, trunc
    補間:       lerp(a, b, t) = a + (b-a)*t
    クランプ:   clip(x, lo, hi), clamp (エイリアス)
    ステップ:   step(edge, x), smoothstep(edge0, edge1, x)
    その他:     mod(a, b), frac(x), deg2rad(x), rad2deg(x)
    組み込み互換: abs, min, max, round, pow（Expr/float両対応）
    定数:       PI, E

  ◆ Objectの主要メソッド
    obj.time(duration=None) ... 表示時間を設定し、selfを返す
                              duration省略時は加工後長length()で自動決定（layer exec後に確定）
                              画像ではtime()省略はTypeError（長さがないため）
    obj.until(name)        ... durationをアンカー時刻まで伸長し、selfを返す
    obj.length()           ... 加工後の再生時間を返す（ffprobe + trim/atrim/atempo反映）
    obj.split()            ... (VideoView or None, AudioView or None) を返す

  ◆ Projectの主要メソッド
    p.configure(**kwargs)  ... width, height, fps, duration, background_color を設定
    p.layer(filename, priority, cache) ... レイヤーファイルを登録
    p.render(output_path, dry_run=False) ... レンダリング実行（dry_run=Trueでコマンドのみ返却）

  ◆ Exprの数値評価メソッド
    expr.eval_at(u_value)  ... Expr式をPythonで数値評価（u=u_valueとして計算）

============================================================
3. DSL文法概要
============================================================

  ◆ オーケストレータ (main.py)
    from scriptvedit import *
    p = Project()
    p.configure(width=1280, height=720, fps=30, background_color="black")
    p.layer("bg.py", priority=0)
    p.layer("maku.py", priority=0, cache="make")
    p.layer("onigiri.py", priority=1)
    p.render("output.mp4")

  ◆ レイヤーファイル (1ファイル=1レイヤー)
    from scriptvedit import *
    obj = Object("image.png")
    obj <= resize(sx=50%P, sy=50%P)       # パーセント記法
    obj.time(6) <= move(x=0.5, y=0.5, anchor="center") \
                   & scale(lambda u: lerp(0.5, 1, u)) \
                   & fade(lambda u: u)

  ◆ <= 演算子 (Object.__le__)
    Objectに対してTransform/Effect/AudioEffectを適用する中心的な演算子。
    obj <= Transform/TransformChain     ... Transform適用 (resize等)
    obj.time(N) <= Effect/EffectChain   ... 時間+Effect適用 (move, scale, fade等)
    obj <= AudioEffect/AudioEffectChain ... AudioEffect適用 (again, afade等)

  ◆ | チェーン (TransformChain)
    resize(sx=0.5, sy=0.5) | resize(sx=2, sy=2)  → TransformChain

  ◆ & チェーン (EffectChain / AudioEffectChain)
    move(...) & scale(...) & fade(...)   → EffectChain
    again(0.8) & afade(lambda u: u)      → AudioEffectChain

  ◆ ~ quality演算子 (fast) 【破壊的変更】
    ~resize(...)       → Transform(quality="fast")  低品質で高速キャッシュ
    ~scale(...)        → Effect(quality="fast")
    ~(tf1 | tf2)       → TransformChain 全opにquality="fast"付与
    ~(eff1 & eff2)     → EffectChain 全opにquality="fast"付与

  ◆ + policy演算子 (force) 【意味変更】
    +resize(...)       → Transform(policy="force")  常に再生成
    +scale(...)        → Effect(policy="force")
    +(tf1 | tf2)       → TransformChain 末尾にpolicy="force"付与

  ◆ - policy演算子 (off) 【新規】
    -resize(...)       → Transform(policy="off")  キャッシュ対象から除外
    -scale(...)        → Effect(policy="off")
    -(tf1 | tf2)       → TransformChain 末尾にpolicy="off"付与

  ◆ 無印 (auto+final) 【デフォルト】
    resize(...)        → Transform(policy="auto", quality="final")
    最右のbakeable opがRAA保存点として自動キャッシュ対象

  ◆ ~ AudioEffect無効化 (従来動作を維持)
    ~again(...)        → _DisabledAudioEffect（Object.__le__でスキップ）

  ◆ %P パーセント記法
    50%P  → 0.5   (Percentクラスの __rmod__)
    100%P → 1.0

  ◆ split() メソッド
    clip = Object("video.mp4")
    v, a = clip.split()
    v <= resize(sx=0.5, sy=0.5)           # 映像系のみOK
    a <= again(0.5) & afade(lambda u: u)   # 音声系のみOK

  ◆ length() メソッド / time() 省略（auto duration）
    clip = Object("video.mp4")
    clip.time(clip.length())   # ffprobeで取得した長さを使用（明示的）
    clip.time() <= trim(3)     # 省略形: trim(3)付与後のlength()=3がdurationに（layer exec後に確定）
    bgm.time() <= atrim(2) & again(0.6)  # duration=2（atrim反映）
    img.time()                 # TypeError（画像は length を持たない）

  ◆ delete / adelete
    obj <= delete()    ... 映像をオーバーレイから除外（音声は残る）
    obj <= adelete()   ... 音声をミックスから除外（映像は残る）

  ◆ anchor/pause/until
    anchor("name")                     ... アンカー登録
    pause.time(N)                      ... 時間だけ占有
    pause.until("name")                ... アンカーまで待機
    obj.until("name")                  ... durationをアンカーまで伸長

  ◆ レイヤーキャッシュ
    p.layer("maku.py", cache="make")   ... VP9 alpha webmキャッシュ生成
    p.layer("maku.py", cache="use")    ... キャッシュから読み込み
    p.layer("maku.py", cache="auto")   ... 存在時利用/なければ通常
    p.layer("maku.py", cache="off")    ... 従来通り（デフォルト）

============================================================
4. チェックポイントキャッシュ 【全面再設計: policy/quality方式】
============================================================

  ◆ 概要
    bakeable ops（Transform全般 + scale/fade/trim Effect）の中間結果を
    signatureベースで自動保存・復元する仕組み。
    保存点はRAA+FSPで最小化。
    _CheckpointTransform/_CheckpointEffectクラスは廃止し、
    Transform/Effect自身にpolicy/quality属性を持たせる方式に変更。

  ◆ policy/quality属性
    Transform/Effectの__init__にkeyword-only引数として追加:
    - policy: "auto"(デフォルト) / "force"(+op) / "off"(-op)
    - quality: "final"(デフォルト) / "fast"(~op)

  ◆ 演算子の意味 【破壊的変更】
    ~op  → quality="fast" の新Transform/Effect返却（旧: autoチェックポイント）
    +op  → policy="force" の新Transform/Effect返却（旧: makeチェックポイント）
    -op  → policy="off" の新Transform/Effect返却（旧: TypeError）
    無印 → policy="auto", quality="final"（RAA保存点として自動キャッシュ対象）

  ◆ チェーンの糖衣構文
    ~(tf1 | tf2)     → 全opにquality="fast"付与
    +(tf1 | tf2)     → 末尾opにpolicy="force"付与
    -(tf1 | tf2)     → 末尾opにpolicy="off"付与

  ◆ bakeable判定 (_is_bakeable)
    Transform → 全てbakeable
    Effect → scale/fade/trim のみbakeable
    move/delete → non-bakeable

  ◆ 保存点計算 (_compute_save_points)
    FSP: policy="force" かつ bakeable の全位置
    RAA: bakeable ops中の最右 policy="auto"（最後のFSP以降にforceがなければ）
    policy="off" は候補から除外

  ◆ bakeable/live分離 (_split_ops)
    checkpoint処理はbakeable opsのみで実行。
    live ops (move/delete) はcheckpoint後にeffectsに戻される。
    これによりmove/deleteがcheckpoint後に消失するバグを修正。

  ◆ 活性化条件
    bakeable ops が1つ以上ある全Object（無印=autoのみでもRAA保存）
    全opがpolicy="off"のObjectはスキップ

  ◆ キャッシュ保存先 【パス変更】
    __cache__/artifacts/checkpoint/{src_hash[:8]}/{signature[:16]}.{ext}
    signature = FFP(source) + OPFP + quality + engine_ver + dur? + fps?
    FFP = _file_fingerprint(source) = (abs_path, size, mtime_ns)
    画像→.png、動画→.webm (video入力 + transform-only でもwebm)

  ◆ 復元ロジック (_find_resume_point)
    最左forceの手前のauto保存点のみresume候補。
    右から探索し、キャッシュファイルが存在する最右のautoを復元点とする。

  ◆ quality="fast"の効果
    動画チェックポイント: crf=40（通常crf=30）で低品質高速エンコード

  ◆ dry_run時の動作
    全Objectで _collect_checkpoint_cmds() → {"main": [...], "cache": {...}}
    bakeable opsを持つ全Objectがcheckpoint出力に含まれる

  ◆ AudioEffectは対象外
    AudioEffectの ~ は従来通り無効化(_DisabledAudioEffect)として動作

============================================================
5. テンプレート機能
============================================================

  ◆ 概要
    よく使うwebレイヤー（字幕・吹き出し・図解）をPython関数1行で生成。
    内部でweb Object (HTML→Playwright→webm) パイプラインを利用。
    templates/ ディレクトリ内のHTMLがテンプレートとして機能。

  ◆ subtitle(text, who, duration, style, size, name, debug_frames)
    画面下部に表示する字幕バー。
  ◆ bubble(text, duration, anchor, pos, box, style, size, name, debug_frames)
    しっぽ付き吹き出し。
  ◆ diagram(objects, duration, style, size, name, debug_frames)
    SVG図解。複数の図形オブジェクトを組み合わせて描画。

============================================================
6. web Object機能（HTMLテンプレート→透明webm→合成）
============================================================

  HTMLテンプレートをPlaywrightで連番PNGにキャプチャし、
  ffmpegで透明webm(VP9/yuva420p)に変換し、通常のObjectとして合成する。

  処理フロー:
    scene.html + data → Playwright(renderFrame) → PNGシーケンス
    → ffmpeg → __cache__/artifacts/web/{name}/{signature}.webm → Object(video)として合成
    signatureベースでキャッシュ判定（テンプレートFFP + data_hash + deps_hash + dur + fps + size + engine_ver）
    deps引数: テンプレートが参照する外部ファイルのリスト。変更検知でキャッシュ無効化。

============================================================
7. 音声機能（AudioEffect、amix、adelay、split、delete/adelete）
============================================================

  ◆ AudioEffect クラス
    音声エフェクトの基底。name + params辞書で構成。
    & 演算子で AudioEffectChain に連結可能。
    ~ 演算子で _DisabledAudioEffect に無効化可能。

  ◆ 音声ファクトリ関数
    again(value=1.0)      ... 音量倍率
    afade(alpha=1.0)      ... 音量フェード
    atrim(duration=None)  ... 音声トリム
    atempo(rate=1.0)      ... テンポ変更
    adelete()             ... 音声をミックスから除外

============================================================
8. ffmpegコマンド生成の仕組み
============================================================

  _build_ffmpeg_cmd(output_path) が最終的なffmpegコマンドリストを生成。
  入力0: 背景色ベースキャンバス (color=c=...)
  入力1〜N: 各Objectのソースファイル

  ◆ 映像チェーン
    各Objectに対し Transform → Effect → overlay で順次合成。
    scaleアニメーション時はpad固定化で振動を防止。

  ◆ 音声チェーン
    AudioEffect適用 → adelay → amix で合成。

  ◆ 出力コーデック
    映像: libx264, yuv420p
    音声: aac
    キャッシュ/チェックポイント: libvpx-vp9, yuva420p（アルファ対応webm）

============================================================
9. Plan/Render 2パスアーキテクチャ
============================================================

  render() の実行フロー:
    1. _reset_runtime_state()
    2. _validate_cache_specs()
    3. _plan_resolve() (Plan pass: アンカー解決)
    4. Render pass: 各レイヤー実行
    5. _resolve_anchors()
    6. duration計算
    7. dry_run分岐:
       True:  _collect_cache_cmds + _collect_web_cmds + web差し替え + _collect_checkpoint_cmds
       False: _ensure_web_objects → _ensure_checkpoints → ffmpeg実行
    ※ web差し替え→checkpoint収集の順序が重要（webソースをwebmに差し替えてからcheckpoint計算）
    ※ _exec_layer 内で _fill_auto_durations() が呼ばれ、time()省略オブジェクトのdurationが確定

============================================================
10. テスト一覧
============================================================

  ◆ スナップショットテスト (test_snapshot.py) - 30テスト
    test01〜test22: 全スナップショット再生成済み（bakeable-only fingerprint + ENGINE_VER=2）
    test23: move保存テスト（resize(force) + move + scaleでmoveが消えないことを確認）
    test24: video checkpointテスト（動画のtransform-only → .webm拡張子）
    test25: time()省略→auto duration（trim(3)付与後のlength()=3がdurationに反映）
    test26: morph_to（画像→画像モーフィング）
    test27: rotate Transform（静的回転30度）
    test28: rotate_to Effect（0→180度回転アニメーション + move保持）
    test29: web + bakeable（scale/fade + web変換後checkpoint共存）
    test30: sin scale中間最大pad（11点サンプリングで正しいpadサイズ）

  ◆ エラーケーステスト (test_errors.py) - 39テスト
    1〜19: 既存テスト
    20. -Transform                → policy="off" 確認
    21. -Effect                   → policy="off" 確認
    22. ~chain糖衣                → 全opがquality="fast" 確認
    23. +force演算子              → policy="force" 確認
    24. -off演算子                → policy="off" 確認
    25. ~fast品質                 → quality="fast" 確認
    26. +chain force              → 末尾policy="force" 確認
    27. FFP変化検出               → ファイル変更でfingerprintが変わることを確認
    28. checkpoint FFP署名         → ファイル変更でキャッシュパスが変化
    29. web deps引数              → deps=["a.png","b.png"]が渡せることを確認
    30. video time未指定checkpoint → durationが自動補完
    31. video time指定checkpoint  → 指定durationが使用される
    32. morph_to非Object          → TypeError
    33. morph_to末尾でない         → ValueError（回避策メッセージ付き）
    34. rotate引数なし             → ValueError
    35. rotate_to引数なし          → ValueError
    36. rotate_to move保持        → checkpoint後もmove保持
    37. morph_to回避策メッセージ   → エラーに「回避策」「除外」が含まれる
    38. probe不可has_audio=False  → probe不可時False
    39. 画像time()省略            → TypeError

  ※ 全テスト test01〜30 + スナップショット30件 + エラーケース39件 全PASS確認済み

============================================================
11. 過去の主要変更（チェックポイント致命点修正）
============================================================

  ◆ 致命的バグ修正1: move/deleteがcheckpoint後に消える問題
    - _split_ops()関数を追加: ops列をbakeable/liveに分離
    - _process_checkpoints(): bakeable_opsのみで処理、live_opsを最後に復元
    - _collect_checkpoint_cmds(): 同じパターンでbakeable/live分離
    - _ensure_checkpoints(): bakeable_opsのみで判定

  ◆ 致命的バグ修正2: signatureにFFPが入っていない問題
    - _checkpoint_cache_path(): original_sourceのFFP(mtime/size)を含めるよう変更
    - ファイル差し替え時に古いキャッシュが誤用されなくなった
    - dry_runでファイルが存在しない場合はパスベースにfallback
    - _ENGINE_VER: "1" → "2" に更新（旧キャッシュ全無効化）

  ◆ Object.cache() / load_cache() / render_object() 廃止
    - 自動チェックポイント(+resize等)に完全移行
    - _make_cached_object()も削除
    - test04/test10のレイヤーファイルを+resize方式に書き換え

  ◆ Web Object deps対応
    - _WEB_KWARGSに"deps"追加
    - Object.__init__: _web_deps初期化 + kwargs取得
    - _web_cache_path(): deps fingerprintを含めるよう拡張
    - subtitle/bubble/diagram: deps引数追加

  ◆ テスト追加
    - test23: move保存テスト（resize + move + scaleでmoveが消えない）
    - test24: video checkpointテスト（動画transform-only → .webm）
    - test_errors: FFP変化検出、checkpoint FFP署名、web deps引数の3件追加
    - 全24スナップショット再生成（ENGINE_VER=2 + bakeable-only fingerprint）

============================================================
12. 最新変更（P0/P1修正 + auto duration）
============================================================

  ◆ P0: web×checkpoint順序修正
    - dry_runパス: web Objectのsource差し替えをcheckpoint収集より前に移動
    - 実レンダパス: _ensure_web_objects()を_ensure_checkpoints()より前に移動
    - web+bakeable(checkpoint)の組み合わせが正しく動作するように

  ◆ P0: scale pad多点サンプリング
    - scaleアニメーション時のpadサイズ計算を端点2点→11点(0.0〜1.0, 0.1刻み)に変更
    - sin波等の中間ピークでpadが不足する問題を解消

  ◆ P1: morph_toエラーメッセージ改善
    - 「回避策: ... を morph_to の前に移動するか、-...(...) で除外」を追記

  ◆ P1: has_audioデフォルトをFalseに変更
    - probe不可時にTrue→Falseに変更（安全側に倒す）

  ◆ Object.time()省略（auto duration）
    - time()引数省略で加工後長length()によるduration自動決定
    - layer exec後に確定（trim/atrim/atempo等の同行指定が反映される）
    - 画像ではTypeError（長さがないため）
    - _fill_auto_durations()を_exec_layer()内で呼出し

  ◆ テスト追加
    - test25: time()省略→auto duration（trim(3)反映）に置換
    - test29: web+bakeable共存テスト
    - test30: sin scale中間最大padテスト
    - test_errors: morph_to回避策メッセージ、probe不可has_audio=False、画像time()省略の3件追加

============================================================
13. 既知の制限・注意事項
============================================================

  1. overlay の enable='between()' で t=0 ジャストが拾われない場合がある
  2. （廃止済み: cache()は削除されたため該当なし）
  3. 同一レイヤー内のオブジェクトは直列配置（並列は別レイヤー）
  4. anchor 循環参照の検出は未実装（反復回数上限+warnings.warn）
  5. Windows環境 (Python 3.10, ffmpeg 8.0) でのみテスト済み
  6. lambda内でmath.sin等は使えない → scriptveditのsin, cos等を使うこと
  7. レイヤーキャッシュはプロジェクト全体duration分
  8. has_audioの判定はffprobeに依存
  9. amixのnormalize=0固定
  10. f-string内にバックスラッシュは使えない
  11. web Object は Playwright が必要
  12. web Object のキャッシュ判定はsignatureベースのwebm存在チェック
  13. eval_at()は基本的な数学関数のみ対応
  14. テンプレートHTMLの座標系は正規化値(0.0〜1.0)
  15. ~演算子の意味: Transform/Effectではquality="fast"、AudioEffectでは無効化
  16. Object.cache()は廃止済み。+resize等の自動チェックポイントを使用すること
  17. 既存スクリプトの~resizeはquality:fastに意味が変わる（破壊的変更）

============================================================
■ 素材ファイル (変更禁止)
============================================================

  bg_pattern_ishigaki.jpg                        石垣模様の背景
  onigiri_tenmusu.png                            天むすおにぎり (透過PNG)
  figure_cafe.png                                カフェの人物 (透過PNG)
  pattern_teishiki_maku.png                      定式幕 (緑/橙/黒の縦縞)
  pop_shinsyakaijin_ganbare.png                  がんばれポップ (透過PNG)
  virus_message_fuyoufukyu_gaisyutsu.png         ウイルスメッセージ (透過PNG)
  Impact-38.mp3                                  インパクト音BGM
  ビックリ音.mp3                                   効果音SE
  fox_noaudio.mp4                                キツネ動画（音声なし）
  flowerbg_noaudio.mp4                           花背景動画（音声なし）
  guitar_noaudio.mp4                             ギター動画（音声なし）
  free-video1-sea-cafinet.mp4                    海の動画
  free-video5-sky-cafinet.mp4                    空の動画

============================================================
■ 開発環境
============================================================

  OS: Windows 11
  Python: 3.10
  ffmpeg: 8.0-full_build
  Playwright: chromium (web Object / テンプレート用)
  Shell: Git Bash / PowerShell

============================================================
